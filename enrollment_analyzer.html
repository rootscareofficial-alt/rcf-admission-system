<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCF Admission Diagnostics & Strategy System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .step-container { display: none; }
        .step-container.active { display: block; }
        .loader { border: 3px solid #f3f4f6; border-top: 3px solid #1d4ed8; border-radius: 50%; width: 48px; height: 48px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .section-tab { cursor: pointer; transition: all 0.2s; }
        .section-tab.active { background: #1d4ed8; color: white; }
        .section-tab:not(.active) { background: #e5e7eb; color: #4b5563; }
        .section-tab:not(.active):hover { background: #d1d5db; }
        .field-section { display: none; }
        .field-section.active { display: block; }
        input, select, textarea { transition: border-color 0.2s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #1d4ed8; box-shadow: 0 0 0 3px rgba(29,78,216,0.1); }
    </style>
</head>
<body class="bg-slate-100 min-h-screen font-sans">

<div class="max-w-4xl mx-auto px-4 py-8">

    <!-- Header -->
    <div class="text-center mb-8">
        <div class="inline-flex items-center gap-3 mb-3">
            <span class="text-4xl">üéì</span>
            <div class="text-left">
                <h1 class="text-2xl font-bold text-blue-900 leading-tight">RCF Admission Diagnostics &</h1>
                <h1 class="text-2xl font-bold text-blue-900 leading-tight">Strategy System</h1>
            </div>
        </div>
        <p class="text-gray-500 text-sm">Rootscare Foundation ¬∑ Powered by AI ¬∑ School Enrollment Growth</p>
    </div>

    <!-- Main Card -->
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden">

        <!-- Top Progress Bar -->
        <div class="bg-blue-900 px-6 py-4">
            <div class="flex justify-between items-center text-xs text-blue-200 mb-2">
                <span id="prog-data" class="font-semibold text-white">üìã Data Input</span>
                <span id="prog-analysis">‚öôÔ∏è Analysis</span>
                <span id="prog-strategy">üìä Strategy</span>
            </div>
            <div class="w-full bg-blue-800 rounded-full h-1.5">
                <div id="progress-bar" class="bg-yellow-400 h-1.5 rounded-full transition-all duration-500" style="width:10%"></div>
            </div>
        </div>

        <div class="p-6">

            <!-- STEP 1: DATA INPUT (10 sections) -->
            <div id="step1" class="step-container active">

                <div class="flex items-center justify-between mb-5">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">School Diagnostic Data</h2>
                        <p class="text-sm text-gray-500 mt-0.5">Complete all 10 sections for the most accurate strategy</p>
                    </div>
                    <span id="section-counter" class="text-sm font-semibold text-blue-700 bg-blue-50 px-3 py-1 rounded-full">Section 1 of 10</span>
                </div>

                <!-- Section Tabs Row 1 -->
                <div class="grid grid-cols-5 gap-1 mb-1 text-xs font-medium">
                    <button onclick="goToSection(1)" id="tab1" class="section-tab active rounded-lg py-2 px-1 text-center">1. Profile</button>
                    <button onclick="goToSection(2)" id="tab2" class="section-tab rounded-lg py-2 px-1 text-center">2. Enrollment</button>
                    <button onclick="goToSection(3)" id="tab3" class="section-tab rounded-lg py-2 px-1 text-center">3. Funnel</button>
                    <button onclick="goToSection(4)" id="tab4" class="section-tab rounded-lg py-2 px-1 text-center">4. Parents</button>
                    <button onclick="goToSection(5)" id="tab5" class="section-tab rounded-lg py-2 px-1 text-center">5. Marketing</button>
                </div>
                <!-- Section Tabs Row 2 -->
                <div class="grid grid-cols-5 gap-1 mb-6 text-xs font-medium">
                    <button onclick="goToSection(6)" id="tab6" class="section-tab rounded-lg py-2 px-1 text-center">6. Brand</button>
                    <button onclick="goToSection(7)" id="tab7" class="section-tab rounded-lg py-2 px-1 text-center">7. Academics</button>
                    <button onclick="goToSection(8)" id="tab8" class="section-tab rounded-lg py-2 px-1 text-center">8. Market</button>
                    <button onclick="goToSection(9)" id="tab9" class="section-tab rounded-lg py-2 px-1 text-center">9. Fees</button>
                    <button onclick="goToSection(10)" id="tab10" class="section-tab rounded-lg py-2 px-1 text-center">10. Goals</button>
                </div>

                <!-- SECTION 1 -->
                <div id="section1" class="field-section active space-y-4">
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded-r-lg">
                        <h3 class="font-bold text-blue-900">Section 1: Basic School Profile</h3>
                        <p class="text-xs text-blue-700 mt-0.5">General information about your school</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">School Name *</label><input type="text" id="schoolName" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Enter full school name"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">City / Area *</label><input type="text" id="location" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Pune, Kothrud"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Board *</label><select id="board" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select board</option><option>CBSE</option><option>ICSE</option><option>State Board</option><option>IB</option><option>Cambridge (IGCSE)</option><option>Other</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Year of Establishment</label><input type="text" id="yearEstd" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 2022 (currently in 3rd year)"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Classes Currently Running *</label><input type="text" id="classesRunning" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Nursery to Grade 8"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Total Staff Strength</label><input type="number" id="totalStaff" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Teaching + Non-teaching total"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">School Type</label><select id="schoolType" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select type</option><option>Co-ed</option><option>Boys Only</option><option>Girls Only</option><option>Residential</option><option>Day School</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Academic Year (Current)</label><input type="text" id="academicYear" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 2025-26"></div>
                        <div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Fee Structure (per grade/term)</label><textarea id="feeStructure" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Nursery ‚Çπ45,000/yr, Gr 1-5 ‚Çπ60,000/yr. Is transport/books extra? Mention here."></textarea></div>
                    </div>
                </div>

                <!-- SECTION 2 -->
                <div id="section2" class="field-section space-y-4">
                    <div class="bg-green-50 border-l-4 border-green-500 p-3 rounded-r-lg">
                        <h3 class="font-bold text-green-900">Section 2: Enrollment Data (Past Performance)</h3>
                        <p class="text-xs text-green-700 mt-0.5">Historical enrollment numbers by year and grade</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Total Enrollment ‚Äì Current Year *</label><input type="number" id="currentEnrollment" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 320"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Total Enrollment ‚Äì Last Year *</label><input type="number" id="lastYearEnrollment" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 240"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Total Enrollment ‚Äì 2 Years Ago</label><input type="number" id="twoYearsEnrollment" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 160"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">New Admissions ‚Äì This Year *</label><input type="number" id="newAdmissions" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 110"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">New Admissions ‚Äì Last Year</label><input type="number" id="lastYearAdmissions" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 90"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Students Who Left This Year (Attrition)</label><input type="number" id="attritionCount" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 30"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Attrition Rate (%) *</label><input type="number" id="attritionRate" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 9.5"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Grade with Highest Enrollment</label><input type="text" id="highestEnrollGrade" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Nursery / Grade 1"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Grade with Lowest Enrollment</label><input type="text" id="lowestEnrollGrade" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Grade 7 / Grade 8"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Primary Reason for Student Exits</label><select id="exitReason" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select reason</option><option>Relocation</option><option>Fee concerns</option><option>Dissatisfaction with quality</option><option>Competition (moved to rival school)</option><option>Don't know</option><option>Other</option></select></div>
                    </div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Grade-wise Current Enrollment Breakdown (optional)</label><textarea id="gradewiseEnrollment" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Nursery: 45, LKG: 42, UKG: 38, Gr1: 35, Gr2: 30..."></textarea></div>
                </div>

                <!-- SECTION 3 -->
                <div id="section3" class="field-section space-y-4">
                    <div class="bg-purple-50 border-l-4 border-purple-500 p-3 rounded-r-lg">
                        <h3 class="font-bold text-purple-900">Section 3: Enrollment Funnel & Conversion Data</h3>
                        <p class="text-xs text-purple-700 mt-0.5">Track each stage from inquiry to admission</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Total Inquiries Received *</label><input type="number" id="inquiries" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 480"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Campus Visits / Tours Conducted *</label><input type="number" id="visits" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 310"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Applications / Forms Submitted *</label><input type="number" id="applications" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 200"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Admission Offers Made</label><input type="number" id="offers" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 160"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Offers Accepted (Fee Paid / Enrolled)</label><input type="number" id="offersAccepted" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 110"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Avg. Response Time to Inquiry</label><select id="responseTime" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Within 1 hour</option><option>Same day</option><option>1‚Äì2 days</option><option>3‚Äì5 days</option><option>More than a week</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Avg. Days from Inquiry to Admission</label><input type="number" id="inquiryToAdmissionDays" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 14"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Top Reason Inquiries Don't Convert</label><select id="dropReason" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Fees too high</option><option>Location/distance</option><option>Competitor preferred</option><option>Slow follow-up</option><option>Not impressed during visit</option><option>Don't know</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Do You Use a CRM / Tracking System?</label><select id="crmUsage" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì dedicated software</option><option>Yes ‚Äì spreadsheet/manual</option><option>No tracking system</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Peak Admission Month(s)</label><input type="text" id="peakMonths" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Feb‚ÄìApril, October"></div>
                    </div>
                </div>

                <!-- SECTION 4 -->
                <div id="section4" class="field-section space-y-4">
                    <div class="bg-orange-50 border-l-4 border-orange-500 p-3 rounded-r-lg">
                        <h3 class="font-bold text-orange-900">Section 4: Parent Demographics & Behaviour</h3>
                        <p class="text-xs text-orange-700 mt-0.5">Understand who your parents are and what drives their decisions</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Primary Parent Profile</label><select id="parentProfile" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Corporate / Salaried professionals</option><option>Business owners / Self-employed</option><option>Government employees</option><option>Mixed</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Household Income Range (Majority)</label><select id="incomeRange" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Below ‚Çπ5 LPA</option><option>‚Çπ5‚Äì10 LPA</option><option>‚Çπ10‚Äì20 LPA</option><option>‚Çπ20 LPA+</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Top Factor Parents Choose Your School</label><select id="topChoiceFactor" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Academic reputation</option><option>Proximity / location</option><option>Fees / affordability</option><option>Infrastructure</option><option>Referral from friend</option><option>Board (CBSE/ICSE etc.)</option><option>Extracurricular</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Average Distance Parents Travel</label><select id="parentDistance" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Within 2 km</option><option>2‚Äì5 km</option><option>5‚Äì10 km</option><option>More than 10 km</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Parent Satisfaction Level</label><select id="parentSatisfaction" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Very High (NPS 8‚Äì10)</option><option>High (NPS 6‚Äì7)</option><option>Average (NPS 4‚Äì5)</option><option>Low (NPS 1‚Äì3)</option><option>Not measured</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">How Often Do Parents Refer Others?</label><select id="referralFrequency" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Actively (most parents refer)</option><option>Sometimes (on request)</option><option>Rarely</option><option>Almost never</option></select></div>
                        <div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Top 2‚Äì3 Parent Complaints or Concerns</label><textarea id="parentComplaints" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Fee hikes without notice, lack of extracurriculars, communication gaps..."></textarea></div>
                    </div>
                </div>

                <!-- SECTION 5 -->
                <div id="section5" class="field-section space-y-4">
                    <div class="bg-teal-50 border-l-4 border-teal-500 p-3 rounded-r-lg">
                        <h3 class="font-bold text-teal-900">Section 5: Marketing & Visibility</h3>
                        <p class="text-xs text-teal-700 mt-0.5">How are parents finding and discovering your school?</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Annual Marketing Budget (‚Çπ) *</label><input type="number" id="marketingBudget" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 300000"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Primary Lead Source *</label><select id="leadSource" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Word of mouth / Referrals</option><option>Google Ads</option><option>Facebook / Instagram</option><option>Walk-ins</option><option>School website</option><option>Hoardings / Print</option><option>Events / Exhibitions</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Do You Run Paid Digital Ads?</label><select id="paidAds" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì regularly</option><option>Yes ‚Äì seasonally (admission time)</option><option>Occasionally / tested</option><option>No</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">School Website Status</label><select id="websiteStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Active and updated regularly</option><option>Exists but outdated</option><option>Basic / minimal</option><option>No website</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Social Media Presence</label><select id="socialMedia" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Active on FB + Instagram + YouTube</option><option>Active on FB + Instagram</option><option>Only Facebook</option><option>Minimal / Inactive</option><option>None</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Google My Business Listing</label><select id="googleBusiness" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì active with reviews</option><option>Yes ‚Äì but not managed</option><option>No listing</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Google Rating (if listed)</label><input type="text" id="googleRating" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 4.2 stars, 56 reviews"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Open House / Admission Events?</label><select id="openHouse" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì multiple times a year</option><option>Yes ‚Äì once a year</option><option>Occasionally</option><option>Never</option></select></div>
                    </div>
                </div>

                <!-- SECTION 6 -->
                <div id="section6" class="field-section space-y-4">
                    <div class="bg-red-50 border-l-4 border-red-500 p-3 rounded-r-lg">
                        <h3 class="font-bold text-red-900">Section 6: Brand Positioning & Reputation</h3>
                        <p class="text-xs text-red-700 mt-0.5">How is your school perceived in the community?</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">School's Unique Selling Proposition (USP)</label><textarea id="schoolUSP" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="What makes your school distinctly different? e.g., Holistic education, Sports focus, NEP-aligned, Small batch sizes..."></textarea></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Brand Awareness in Local Area</label><select id="brandAwareness" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Very well known</option><option>Known in nearby localities</option><option>Known only in immediate area</option><option>Not well known yet</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">School's Biggest Strength (parents' view)</label><select id="biggestStrength" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Teachers / Faculty quality</option><option>Infrastructure / facilities</option><option>Academic results</option><option>Values and culture</option><option>Extracurricular</option><option>Technology integration</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Biggest Perceived Weakness</label><select id="biggestWeakness" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>New school / Less track record</option><option>High fees</option><option>Limited classes/grades</option><option>Weak marketing / visibility</option><option>Infrastructure still developing</option><option>Not sure</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Clear Tagline / Brand Promise?</label><select id="tagline" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì clearly communicated</option><option>Yes ‚Äì but not consistently used</option><option>No</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Recent PR / Media Coverage?</label><select id="prCoverage" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì regular news coverage</option><option>Yes ‚Äì occasional</option><option>No</option></select></div>
                        <div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Awards, Recognitions or Achievements</label><textarea id="awards" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Best new school 2024, CBSE affiliation, 100% board results..."></textarea></div>
                    </div>
                </div>

                <!-- SECTION 7 -->
                <div id="section7" class="field-section space-y-4">
                    <div class="bg-indigo-50 border-l-4 border-indigo-500 p-3 rounded-r-lg">
                        <h3 class="font-bold text-indigo-900">Section 7: Academics & Student Experience</h3>
                        <p class="text-xs text-indigo-700 mt-0.5">What happens inside the school that drives retention</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Average Class / Batch Size</label><input type="number" id="batchSize" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 25 students per class"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Student-to-Teacher Ratio</label><input type="text" id="studentTeacherRatio" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 20:1"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Academic Results / Performance</label><select id="academicPerformance" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Excellent ‚Äì top results in area</option><option>Good ‚Äì above average</option><option>Average</option><option>Still early to measure</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Teacher Retention / Stability</label><select id="teacherRetention" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>High ‚Äì most teachers stay</option><option>Medium ‚Äì some turnover</option><option>High turnover / Challenge</option></select></div>
                        <div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Key Extracurricular / Programmes Offered</label><textarea id="extracurricular" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Sports, Dance, Music, Coding, Art, Robotics, Yoga, Theatre..."></textarea></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Technology in Classrooms</label><select id="techInClass" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Smart boards + digital learning</option><option>Projectors / basic tech</option><option>Minimal</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Parent Communication App / Tool</label><select id="parentApp" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Dedicated school app</option><option>WhatsApp groups</option><option>Email + phone</option><option>No structured system</option></select></div>
                    </div>
                </div>

                <!-- SECTION 8 -->
                <div id="section8" class="field-section space-y-4">
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-3 rounded-r-lg">
                        <h3 class="font-bold text-yellow-900">Section 8: Local Market & Catchment Area</h3>
                        <p class="text-xs text-yellow-700 mt-0.5">Understand the competitive landscape around you</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Competing Schools in 5 km Radius</label><select id="competitors" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>1‚Äì3 schools</option><option>4‚Äì7 schools</option><option>8‚Äì12 schools</option><option>More than 12</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Biggest Competitor School</label><input type="text" id="biggestCompetitor" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="Name of primary competitor"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Why Parents Choose Competitor Over You</label><select id="competitorAdvantage" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Established brand / older school</option><option>Lower fees</option><option>Better academics / results</option><option>Better infrastructure</option><option>Closer location</option><option>Don't know</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">School-Age Children in Catchment (est.)</label><select id="catchmentSize" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Less than 2,000</option><option>2,000‚Äì5,000</option><option>5,000‚Äì10,000</option><option>More than 10,000</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Is the Area Growing? (New residential projects)</label><select id="areaGrowth" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì rapidly growing</option><option>Yes ‚Äì moderate growth</option><option>Stable / mature area</option><option>Declining population</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Feeder Preschools Nearby?</label><select id="feederSchools" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì and we have partnerships</option><option>Yes ‚Äì but no partnerships</option><option>No feeder schools nearby</option></select></div>
                        <div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Key Localities / Neighbourhoods in Catchment</label><input type="text" id="keyLocalities" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., Baner, Balewadi, Wakad, Hinjewadi"></div>
                    </div>
                </div>

                <!-- SECTION 9 -->
                <div id="section9" class="field-section space-y-4">
                    <div class="bg-pink-50 border-l-4 border-pink-500 p-3 rounded-r-lg">
                        <h3 class="font-bold text-pink-900">Section 9: Fee & Value Perception</h3>
                        <p class="text-xs text-pink-700 mt-0.5">How families perceive your fee vis-√†-vis value delivered</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Annual Fee Range (lowest to highest grade)</label><input type="text" id="feeRange" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., ‚Çπ40,000 ‚Äì ‚Çπ80,000 per year"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Fees vs Local Competitor</label><select id="feeVsCompetitor" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>We are cheaper than most</option><option>Similar to competitors</option><option>We are 10‚Äì20% more expensive</option><option>We are 30%+ more expensive</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Do Parents Feel Fees Are Value for Money?</label><select id="valueMoney" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì strongly</option><option>Yes ‚Äì mostly</option><option>Mixed opinions</option><option>No ‚Äì common complaint</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Fee Flexibility / Scholarships?</label><select id="scholarships" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì merit scholarships</option><option>Yes ‚Äì need-based support</option><option>Sibling discounts</option><option>No flexibility</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Is Fee Hike a Common Attrition Reason?</label><select id="feeHikeAttrition" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Yes ‚Äì major reason</option><option>Occasionally mentioned</option><option>Rarely / No</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Payment Options Offered</label><select id="paymentOptions" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="">Select</option><option>Annual / Yearly only</option><option>Half-yearly</option><option>Quarterly</option><option>Monthly EMI</option></select></div>
                    </div>
                </div>

                <!-- SECTION 10 -->
                <div id="section10" class="field-section space-y-4">
                    <div class="bg-blue-900 border-l-4 border-yellow-400 p-3 rounded-r-lg">
                        <h3 class="font-bold text-white">Section 10: Enrollment Goals</h3>
                        <p class="text-xs text-blue-200 mt-0.5">Set your targets ‚Äî we'll build the entire plan around these</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Target Total Enrollment *</label><input type="number" id="targetEnrollment" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 500"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Target New Admissions *</label><input type="number" id="targetAdmissions" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 180"></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Timeline to Achieve Goal</label><select id="timeline" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="4months" selected>4 months (Intensive ‚Äì Recommended)</option><option value="6months">6 months</option><option value="1year">1 Academic Year</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Primary Focus</label><select id="focusArea" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="newadmissions">Increase New Admissions</option><option value="retention">Improve Student Retention</option><option value="both">Both Equally</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Plan Detail Level</label><select id="planDetail" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"><option value="standard">Standard Plan (Monthly milestones)</option><option value="detailed">Detailed Plan (Week-by-week actionables)</option></select></div>
                        <div><label class="block text-sm font-medium text-gray-700 mb-1">Additional Marketing Budget Available (%)</label><input type="number" id="budgetIncrease" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., 20" value="0"></div>
                        <div class="col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1">Any Additional Context or Challenges?</label><textarea id="additionalContext" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g., New competitor opened nearby, planning to add Grade 9, budget constraints, specific events planned..."></textarea></div>
                    </div>
                </div>

                <!-- Nav Buttons -->
                <div class="flex justify-between mt-6 pt-4 border-t border-gray-100">
                    <button id="prevBtn" onclick="changeSection(-1)" class="hidden px-5 py-2.5 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition text-sm">‚Üê Previous</button>
                    <div class="flex gap-3 ml-auto">
                        <button id="nextBtn" onclick="changeSection(1)" class="px-6 py-2.5 bg-blue-700 text-white font-semibold rounded-lg hover:bg-blue-800 transition text-sm">Next Section ‚Üí</button>
                        <button id="generateBtn" onclick="generateStrategy()" class="hidden px-6 py-2.5 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition text-sm">üöÄ Generate My Strategy</button>
                    </div>
                </div>
            </div>

            <!-- STEP 3: LOADING -->
            <div id="step3" class="step-container">
                <div class="text-center py-16">
                    <div class="loader mx-auto mb-6"></div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Running Deep Diagnostics...</h2>
                    <p class="text-gray-500 text-sm mb-6">AI is analysing all 10 sections of your school data</p>
                    <div id="analysisProgress" class="text-sm text-blue-700 font-medium bg-blue-50 px-5 py-2 rounded-full inline-block mb-8"></div>
                    <div><button onclick="goBackToForm()" class="px-4 py-2 bg-gray-200 text-gray-600 text-sm rounded-lg hover:bg-gray-300 transition">‚Üê Back to Edit Data</button></div>
                </div>
            </div>

            <!-- STEP 4: STRATEGY OUTPUT -->
            <div id="step4" class="step-container">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Your Customised Growth Strategy</h2>
                        <p class="text-sm text-gray-500">Based on complete 10-section diagnostic ¬∑ <span id="schoolNameDisplay" class="font-semibold text-blue-700"></span></p>
                    </div>
                    <button onclick="downloadStrategy()" class="px-4 py-2 bg-green-600 text-white text-sm font-semibold rounded-lg hover:bg-green-700 transition flex-shrink-0">‚¨á Download Report</button>
                </div>
                <div id="strategyOutput" class="space-y-4"></div>
                <div class="flex gap-3 mt-8 pt-6 border-t border-gray-100">
                    <button onclick="goBackToSection(10)" class="flex-1 px-4 py-2.5 bg-gray-400 text-white text-sm font-semibold rounded-lg hover:bg-gray-500 transition">‚Üê Edit Goals</button>
                    <button onclick="goBackToForm()" class="flex-1 px-4 py-2.5 bg-gray-500 text-white text-sm font-semibold rounded-lg hover:bg-gray-600 transition">‚Üê Edit All Data</button>
                    <button onclick="resetSystem()" class="flex-1 px-4 py-2.5 bg-blue-900 text-white text-sm font-semibold rounded-lg hover:bg-blue-800 transition">üîÑ New Analysis</button>
                </div>
            </div>

        </div>
    </div>
    <p class="text-center text-xs text-gray-400 mt-4">¬© 2026 Rootscare Foundation ¬∑ RCF Admission Diagnostics & Strategy System</p>
</div>

<script>
    let currentSection = 1;
    let schoolData = {};
    let goalsData = {};

    function updateProgress(step) {
        const elems = { 'prog-data': 1, 'prog-analysis': 2, 'prog-strategy': 3 };
        const bar = { 1: '10%', 2: '65%', 3: '100%' };
        Object.entries(elems).forEach(([id, s]) => {
            document.getElementById(id).className = s <= step ? 'font-semibold text-white' : 'text-blue-300';
        });
        document.getElementById('progress-bar').style.width = bar[step] || '10%';
    }

    function goToSection(n) {
        document.getElementById('section' + currentSection).classList.remove('active');
        document.getElementById('tab' + currentSection).classList.remove('active');
        currentSection = n;
        document.getElementById('section' + n).classList.add('active');
        document.getElementById('tab' + n).classList.add('active');
        document.getElementById('section-counter').textContent = 'Section ' + n + ' of 10';
        document.getElementById('prevBtn').classList.toggle('hidden', n === 1);
        document.getElementById('nextBtn').classList.toggle('hidden', n === 10);
        document.getElementById('generateBtn').classList.toggle('hidden', n !== 10);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function changeSection(dir) {
        const next = currentSection + dir;
        if (next >= 1 && next <= 10) goToSection(next);
    }

    function goBackToForm() {
        document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
        document.getElementById('step1').classList.add('active');
        updateProgress(1);
    }

    function goBackToSection(n) {
        goBackToForm();
        goToSection(n);
    }

    function collectAllData() {
        const g = id => (document.getElementById(id)||{}).value||'';
        const n = id => parseInt(g(id))||0;
        const f = id => parseFloat(g(id))||0;
        schoolData = {
            schoolName:g('schoolName'),location:g('location'),board:g('board'),yearEstd:g('yearEstd'),
            classesRunning:g('classesRunning'),totalStaff:n('totalStaff'),feeStructure:g('feeStructure'),
            academicYear:g('academicYear'),schoolType:g('schoolType'),
            currentEnrollment:n('currentEnrollment'),lastYearEnrollment:n('lastYearEnrollment'),
            twoYearsEnrollment:n('twoYearsEnrollment'),newAdmissions:n('newAdmissions'),
            lastYearAdmissions:n('lastYearAdmissions'),attritionCount:n('attritionCount'),
            attritionRate:f('attritionRate'),highestEnrollGrade:g('highestEnrollGrade'),
            lowestEnrollGrade:g('lowestEnrollGrade'),exitReason:g('exitReason'),
            gradewiseEnrollment:g('gradewiseEnrollment'),
            inquiries:n('inquiries'),visits:n('visits'),applications:n('applications'),
            offers:n('offers'),offersAccepted:n('offersAccepted'),responseTime:g('responseTime'),
            inquiryToAdmissionDays:n('inquiryToAdmissionDays'),dropReason:g('dropReason'),
            crmUsage:g('crmUsage'),peakMonths:g('peakMonths'),
            parentProfile:g('parentProfile'),incomeRange:g('incomeRange'),
            topChoiceFactor:g('topChoiceFactor'),parentDistance:g('parentDistance'),
            parentSatisfaction:g('parentSatisfaction'),referralFrequency:g('referralFrequency'),
            parentComplaints:g('parentComplaints'),
            marketingBudget:n('marketingBudget'),leadSource:g('leadSource'),paidAds:g('paidAds'),
            websiteStatus:g('websiteStatus'),socialMedia:g('socialMedia'),googleBusiness:g('googleBusiness'),
            googleRating:g('googleRating'),openHouse:g('openHouse'),
            schoolUSP:g('schoolUSP'),brandAwareness:g('brandAwareness'),biggestStrength:g('biggestStrength'),
            biggestWeakness:g('biggestWeakness'),tagline:g('tagline'),prCoverage:g('prCoverage'),awards:g('awards'),
            batchSize:n('batchSize'),studentTeacherRatio:g('studentTeacherRatio'),
            academicPerformance:g('academicPerformance'),teacherRetention:g('teacherRetention'),
            extracurricular:g('extracurricular'),techInClass:g('techInClass'),parentApp:g('parentApp'),
            competitors:g('competitors'),biggestCompetitor:g('biggestCompetitor'),
            competitorAdvantage:g('competitorAdvantage'),catchmentSize:g('catchmentSize'),
            areaGrowth:g('areaGrowth'),feederSchools:g('feederSchools'),keyLocalities:g('keyLocalities'),
            feeRange:g('feeRange'),feeVsCompetitor:g('feeVsCompetitor'),valueMoney:g('valueMoney'),
            scholarships:g('scholarships'),feeHikeAttrition:g('feeHikeAttrition'),paymentOptions:g('paymentOptions'),
        };
        goalsData = {
            targetEnrollment:n('targetEnrollment'),targetAdmissions:n('targetAdmissions'),
            timeline:g('timeline'),focusArea:g('focusArea'),planDetail:g('planDetail'),
            budgetIncrease:n('budgetIncrease'),additionalContext:g('additionalContext'),
        };
    }

    async function generateStrategy() {
        collectAllData();
        if (!schoolData.schoolName || !schoolData.currentEnrollment) {
            alert('Please fill in at least School Name (Section 1) and Current Enrollment (Section 2)'); return;
        }
        if (!goalsData.targetAdmissions) {
            alert('Please enter your Target New Admissions in Section 10'); return;
        }
        document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
        document.getElementById('step3').classList.add('active');
        updateProgress(2);

        const msgs = ['Analysing enrollment trends...','Evaluating admission funnel...','Profiling parent demographics...','Assessing brand & market position...','Calculating conversion rates...','Benchmarking against competition...','Identifying growth levers...','Building your strategic plan...'];
        let i = 0;
        const ticker = setInterval(() => { document.getElementById('analysisProgress').textContent = msgs[i++ % msgs.length]; }, 900);
        try { await callClaudeAPI(); } finally { clearInterval(ticker); }
    }

    async function callClaudeAPI() {
        const timelineText = goalsData.timeline === '4months' ? '4 months (16 weeks)' : goalsData.timeline === '6months' ? '6 months (24 weeks)' : '1 academic year';
        const prompt = `You are an expert education consultant for Indian K-12 schools working with Rootscare Foundation. Analyse this complete 10-section school diagnostic and generate a highly specific, data-driven strategic plan.

SCHOOL: ${schoolData.schoolName} | ${schoolData.location} | ${schoolData.board} | ${schoolData.classesRunning}
ESTABLISHED: ${schoolData.yearEstd} | STAFF: ${schoolData.totalStaff} | TYPE: ${schoolData.schoolType}
FEES: ${schoolData.feeStructure}

ENROLLMENT HISTORY:
- Current Year: ${schoolData.currentEnrollment} | Last Year: ${schoolData.lastYearEnrollment} | 2 Years Ago: ${schoolData.twoYearsEnrollment}
- New Admissions This Year: ${schoolData.newAdmissions} | Last Year: ${schoolData.lastYearAdmissions}
- Students Left: ${schoolData.attritionCount} | Attrition Rate: ${schoolData.attritionRate}%
- Highest Grade: ${schoolData.highestEnrollGrade} | Lowest Grade: ${schoolData.lowestEnrollGrade}
- Exit Reason: ${schoolData.exitReason} | Grade-wise: ${schoolData.gradewiseEnrollment}

FUNNEL DATA:
- Inquiries: ${schoolData.inquiries} ‚Üí Visits: ${schoolData.visits} ‚Üí Applications: ${schoolData.applications} ‚Üí Offers: ${schoolData.offers} ‚Üí Enrolled: ${schoolData.offersAccepted}
- Response Time: ${schoolData.responseTime} | Days to Admit: ${schoolData.inquiryToAdmissionDays}
- Drop Reason: ${schoolData.dropReason} | CRM: ${schoolData.crmUsage} | Peak Months: ${schoolData.peakMonths}

PARENT PROFILE:
- Profile: ${schoolData.parentProfile} | Income: ${schoolData.incomeRange}
- Choice Factor: ${schoolData.topChoiceFactor} | Distance: ${schoolData.parentDistance}
- Satisfaction: ${schoolData.parentSatisfaction} | Referrals: ${schoolData.referralFrequency}
- Complaints: ${schoolData.parentComplaints}

MARKETING:
- Budget: ‚Çπ${schoolData.marketingBudget} | Lead Source: ${schoolData.leadSource}
- Paid Ads: ${schoolData.paidAds} | Website: ${schoolData.websiteStatus}
- Social Media: ${schoolData.socialMedia} | Google: ${schoolData.googleBusiness} (${schoolData.googleRating})
- Open House: ${schoolData.openHouse}

BRAND & REPUTATION:
- USP: ${schoolData.schoolUSP} | Awareness: ${schoolData.brandAwareness}
- Strength: ${schoolData.biggestStrength} | Weakness: ${schoolData.biggestWeakness}
- Tagline: ${schoolData.tagline} | PR: ${schoolData.prCoverage} | Awards: ${schoolData.awards}

ACADEMICS & EXPERIENCE:
- Batch Size: ${schoolData.batchSize} | Ratio: ${schoolData.studentTeacherRatio}
- Results: ${schoolData.academicPerformance} | Teacher Retention: ${schoolData.teacherRetention}
- Extracurricular: ${schoolData.extracurricular} | Tech: ${schoolData.techInClass} | Parent App: ${schoolData.parentApp}

LOCAL MARKET:
- Competitors Nearby: ${schoolData.competitors} | Biggest: ${schoolData.biggestCompetitor}
- Why They Choose Competitor: ${schoolData.competitorAdvantage}
- Catchment Children: ${schoolData.catchmentSize} | Area Growth: ${schoolData.areaGrowth}
- Feeder Schools: ${schoolData.feederSchools} | Key Areas: ${schoolData.keyLocalities}

FEES & VALUE:
- Range: ${schoolData.feeRange} | vs Competitors: ${schoolData.feeVsCompetitor}
- Value Perception: ${schoolData.valueMoney} | Scholarships: ${schoolData.scholarships}
- Fee Hike Attrition: ${schoolData.feeHikeAttrition} | Payment: ${schoolData.paymentOptions}

GOALS:
- Target Enrollment: ${goalsData.targetEnrollment} | Target New Admissions: ${goalsData.targetAdmissions}
- Timeline: ${timelineText} | Focus: ${goalsData.focusArea} | Plan Type: ${goalsData.planDetail}
- Extra Budget: ${goalsData.budgetIncrease}% | Context: ${goalsData.additionalContext}

Generate a HIGHLY SPECIFIC strategy report in clean HTML. Every insight must reference actual data above. Structure:

<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">üîç 1. Enrollment Diagnostic Summary</h2>
[Key metrics, calculated conversion rates at each funnel stage, YoY growth analysis, attrition analysis ‚Äî all with actual numbers]

<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">üìä 2. Gap Analysis</h2>
[Exact gap, required weekly admission rate, honest feasibility assessment]

<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">üéØ 3. Root Cause Analysis</h2>
[Top 3-5 actual barriers specific to this school's data ‚Äî reference their real answers]

<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">üöÄ 4. Prioritised Strategic Recommendations</h2>
[6+ specific strategies, each: what, why (citing their data), impact, owner, timeline]

<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">üì£ 5. Marketing & Lead Generation Plan</h2>
[Channel-specific plan using their actual budget of ‚Çπ${schoolData.marketingBudget}, weekly targets]

<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">üîÑ 6. Admission Funnel Optimisation</h2>
[Fix their specific weak links, conversion targets based on their data]

<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">‚ù§Ô∏è 7. Retention & Parent Satisfaction Plan</h2>
[Address their specific attrition reasons and parent complaints]

${goalsData.planDetail === 'detailed' ? `<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">üìÖ 8. Week-by-Week Roadmap (16 Weeks)</h2>
[Each week: specific tasks, owner, targets, admission milestone, red flag triggers]` : `<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">üìÖ 8. Month-by-Month Roadmap</h2>
[Each month: key activities, targets, checkpoints]`}

<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">üìà 9. KPIs & Weekly Dashboard</h2>
[Specific measurable targets based on their data]

<h2 style="color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px">‚ö†Ô∏è 10. Risks & Contingency Plans</h2>
[Specific to their competitive situation, what to do if behind at Week 4, 8, 12]

Use colored boxes, tables, and bullet points. Make it look like a professional consultant report. Be very specific ‚Äî no generic advice.`;

        try {
            const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ model: "claude-sonnet-4-20250514", max_tokens: 4000, messages: [{ role: "user", content: prompt }] })
            });
            const data = await response.json();
            const content = data.content && data.content[0] ? data.content[0].text : null;
            displayStrategy(content || generateFallbackStrategy());
        } catch (err) {
            console.error(err);
            displayStrategy(generateFallbackStrategy());
        }
    }

    function displayStrategy(content) {
        document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
        document.getElementById('step4').classList.add('active');
        updateProgress(3);
        document.getElementById('schoolNameDisplay').textContent = schoolData.schoolName;
        const gap = goalsData.targetEnrollment - schoolData.currentEnrollment;
        const conv = schoolData.inquiries ? ((schoolData.newAdmissions/schoolData.inquiries)*100).toFixed(1) : 'N/A';
        const growth = schoolData.lastYearEnrollment ? (((schoolData.currentEnrollment-schoolData.lastYearEnrollment)/schoolData.lastYearEnrollment)*100).toFixed(1) : 'N/A';
        const tl = goalsData.timeline === '4months' ? '4-Month' : goalsData.timeline === '6months' ? '6-Month' : '1-Year';
        document.getElementById('strategyOutput').innerHTML = `
            <div class="bg-blue-900 text-white p-5 rounded-xl mb-2">
                <div class="flex justify-between items-start flex-wrap gap-2">
                    <div>
                        <h3 class="font-bold text-lg">${schoolData.schoolName} ¬∑ ${schoolData.location}</h3>
                        <p class="text-blue-200 text-sm mt-0.5">${schoolData.board} ¬∑ ${schoolData.classesRunning} ¬∑ Generated ${new Date().toLocaleDateString('en-IN')}</p>
                    </div>
                    <span class="bg-yellow-400 text-blue-900 text-xs font-bold px-3 py-1.5 rounded-full">${tl} Intensive Plan</span>
                </div>
                <div class="grid grid-cols-4 gap-2 mt-4">
                    <div class="bg-blue-800 rounded-lg p-3 text-center"><p class="text-blue-300 text-xs">Current</p><p class="text-white font-bold text-xl">${schoolData.currentEnrollment}</p></div>
                    <div class="bg-blue-800 rounded-lg p-3 text-center"><p class="text-blue-300 text-xs">Target</p><p class="text-yellow-400 font-bold text-xl">${goalsData.targetEnrollment}</p></div>
                    <div class="bg-blue-800 rounded-lg p-3 text-center"><p class="text-blue-300 text-xs">Gap</p><p class="text-red-300 font-bold text-xl">${gap}</p></div>
                    <div class="bg-blue-800 rounded-lg p-3 text-center"><p class="text-blue-300 text-xs">Conversion</p><p class="text-green-300 font-bold text-xl">${conv}%</p></div>
                </div>
            </div>
            <div class="prose prose-sm max-w-none bg-white rounded-xl border border-gray-100 p-6">${content}</div>`;
    }

    function generateFallbackStrategy() {
        const weeksTotal = goalsData.timeline === '4months' ? 16 : 24;
        const admPerWeek = Math.ceil(goalsData.targetAdmissions / weeksTotal);
        const conv = schoolData.inquiries ? ((schoolData.newAdmissions/schoolData.inquiries)*100).toFixed(1) : 20;
        const gap = goalsData.targetEnrollment - schoolData.currentEnrollment;
        return `<div class="space-y-4">
            <div class="bg-red-50 border-l-4 border-red-600 p-4 rounded-r-lg"><h3 class="font-bold text-red-900">‚ö° ${goalsData.timeline==='4months'?'4-Month':'6-Month'} Intensive Plan ¬∑ ${goalsData.targetAdmissions} new admissions needed</h3><p class="text-red-700 mt-1">Rate required: <strong>${admPerWeek} admissions/week</strong></p></div>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-blue-50 p-4 rounded-lg"><p class="text-xs text-gray-600">Inquiry‚ÜíAdmission Rate</p><p class="text-2xl font-bold text-blue-900">${conv}%</p><p class="text-xs text-gray-500">Industry benchmark: 28‚Äì35%</p></div>
                <div class="bg-red-50 p-4 rounded-lg"><p class="text-xs text-gray-600">Enrollment Gap</p><p class="text-2xl font-bold text-red-900">${gap}</p><p class="text-xs text-gray-500">students still needed</p></div>
                <div class="bg-orange-50 p-4 rounded-lg"><p class="text-xs text-gray-600">Attrition Rate</p><p class="text-2xl font-bold text-orange-900">${schoolData.attritionRate}%</p><p class="text-xs text-gray-500">Target: below ${Math.max(3,schoolData.attritionRate-3)}%</p></div>
                <div class="bg-green-50 p-4 rounded-lg"><p class="text-xs text-gray-600">Marketing Budget</p><p class="text-2xl font-bold text-green-900">‚Çπ${(schoolData.marketingBudget/100000).toFixed(1)}L</p><p class="text-xs text-gray-500">per year</p></div>
            </div>
            <div class="bg-white border border-gray-200 rounded-lg p-4"><h3 class="font-bold text-gray-800 mb-3">üöÄ Top Priority Actions (Start Today)</h3>
            <div class="space-y-2">
                ${[['üö®','Launch Facebook/Instagram + Google Ads immediately','Day 1'],['üìû','Call all past inquiries from last 12 months','Day 1‚Äì3'],['üé™','Schedule Open House Weekend event','Week 2'],['üí∞','Launch parent referral program (‚Çπ5,000 incentive)','Week 1'],['‚ö°','Implement 30-min inquiry response SLA','Day 1'],['ü§ù','Partner with nearby preschools/feeder schools','Week 2‚Äì4']].map(([ic,txt,t])=>`<div class="flex items-center gap-3 p-2 bg-gray-50 rounded"><span>${ic}</span><p class="text-sm text-gray-700 flex-1">${txt}</p><span class="text-xs text-gray-400 whitespace-nowrap">${t}</span></div>`).join('')}
            </div></div>
            <p class="text-xs text-gray-400 text-center">Note: For full AI-powered detailed strategy, please ensure internet connectivity and try again.</p></div>`;
    }

    function downloadStrategy() {
        const html = document.getElementById('strategyOutput').innerHTML;
        const full = `<!DOCTYPE html><html><head><title>RCF Strategy - ${schoolData.schoolName}</title><style>body{font-family:Arial,sans-serif;max-width:950px;margin:0 auto;padding:30px;color:#1f2937}h2{color:#1d4ed8;border-bottom:2px solid #3b82f6;padding-bottom:8px;margin-top:30px}h3{color:#374151}table{width:100%;border-collapse:collapse}td,th{border:1px solid #e5e7eb;padding:8px 12px;font-size:14px}th{background:#f3f4f6;font-weight:600}ul{line-height:1.8}</style></head><body><h1 style="color:#1e3a8a">RCF Admission Diagnostics & Strategy Report</h1><p><strong>School:</strong> ${schoolData.schoolName} | <strong>Location:</strong> ${schoolData.location} | <strong>Date:</strong> ${new Date().toLocaleDateString('en-IN')}</p><p><strong>Generated by:</strong> Rootscare Foundation Admission Diagnostics & Strategy System</p><hr style="margin:20px 0">${html}</body></html>`;
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([full],{type:'text/html'}));
        a.download = `RCF-Strategy-${schoolData.schoolName.replace(/\s+/g,'-')}-${new Date().toISOString().slice(0,10)}.html`;
        a.click();
    }

    function resetSystem() {
        schoolData={}; goalsData={};
        document.querySelectorAll('input,select,textarea').forEach(el=>el.value='');
        document.getElementById('budgetIncrease').value='0';
        document.getElementById('timeline').value='4months';
        document.getElementById('planDetail').value='standard';
        document.querySelectorAll('.step-container').forEach(el=>el.classList.remove('active'));
        document.getElementById('step1').classList.add('active');
        updateProgress(1);
        goToSection(1);
    }
</script>
</body>
</html>
